<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Astronomick√° p≈ôedpovƒõƒè ‚Äì komplet</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<!-- Astronomy Engine (optional, kept for future use) -->
<script src="https://cdn.jsdelivr.net/npm/astronomy-engine@2.1.0/astronomy.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet"/>
<style>
  :root {
    --bg: #0b0c10;
    --panel: #1f2833;
    --accent: #00ffc3;
    --border: #3e5363;
    --text: #dcdcdc;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(to bottom, #0b0c1a, #1b2c3a);
    background-size: 400% 400%;
    animation: gradientShift 60s ease infinite;
    color: var(--text);
    padding: 16px;
  }
  @keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  h1 {
    margin: 8px 0 16px 0;
    text-align: center;
    color: #fff;
    font-size: 2.1rem;
    text-shadow: 0 0 14px var(--accent);
  }
  .topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
  }
  .version-tag {
    background: var(--accent);
    color: #000;
    font-weight: bold;
    padding: 4px 10px;
    border-radius: 8px;
    box-shadow: 0 0 8px rgba(0,255,195,0.6);
  }
  .menu-container { position: relative; }
  .menu-toggle {
    background: var(--accent);
    color: #000;
    font-weight: bold;
    padding: 6px 12px;
    border-radius: 8px;
    cursor: pointer;
    border: none;
    box-shadow: 0 0 8px rgba(0,255,195,0.6);
  }
  .menu-dropdown {
    display: none;
    position: absolute;
    top: 110%;
    right: 0;
    background-color: var(--panel);
    border: 1px solid var(--border);
    border-radius: 10px;
    min-width: 220px;
    box-shadow: 0px 8px 16px rgba(0,0,0,0.6);
    overflow: hidden;
    z-index: 20;
  }
  .menu-item, .menu-dropdown a {
    display: block;
    padding: 10px 16px;
    color: var(--accent);
    text-decoration: none;
    cursor: pointer;
  }
  .menu-item:hover, .menu-dropdown a:hover {
    background: #2e8b57;
    color: #fff;
  }

  .controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 12px;
  }
  .input-wrapper { position: relative; }
  #cityInput {
    width: 320px; max-width: 100%;
    padding: 10px 36px 10px 12px;
    border-radius: 10px;
    border: 2px solid var(--accent);
    background: #111;
    color: var(--accent);
    font-weight: 600;
  }
  .btn {
    background: var(--accent);
    color: #000;
    font-weight: bold;
    padding: 10px 12px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    box-shadow: 0 0 8px rgba(0,255,195,0.6);
  }
  #suggestions {
    position: absolute; top: 100%; left: 0; right: 0;
    background: #121212;
    border: 1px solid var(--border);
    border-radius: 10px;
    list-style: none; padding: 0; margin: 6px 0 0 0;
    display: none; overflow: hidden; z-index: 30;
  }
  #suggestions li { padding: 10px 12px; cursor: pointer; }
  #suggestions li:hover { background: #243442; }

  .layout { display: flex; gap: 16px; align-items: stretch; flex-wrap: wrap; }
  .info-container { flex: 1 1 60%; display: flex; flex-direction: column; gap: 16px; min-width: 300px; }
  .map-container { flex: 1 1 40%; display: flex; flex-direction: column; gap: 16px; min-width: 260px; }

  .panel {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.5);
  }
  .panel strong { color: var(--accent); }
  .kv { display: grid; grid-template-columns: max-content 1fr; gap: 6px 10px; }
  #map { width: 100%; aspect-ratio: 1 / 1; border-radius: 10px; }
  #windyFrame { width: 100%; border: none; border-radius: 10px; height: 400px; }

  .forecast-day { border: 1px solid var(--border); border-radius: 10px; overflow: hidden; }
  .forecast-day h3 {
    margin: 0; padding: 10px; background: #4b3f72; color: #fff; display: flex; align-items: center; gap: 8px; cursor: pointer;
  }
  .forecast-content { display: none; padding: 10px; }
  .forecast-scroll-wrapper { position: relative; }
  .forecast-scroll { display: flex; gap: 8px; overflow-x: auto; padding: 6px 0; }
  .forecast-card { min-width: 80px; font-size: .9em; background: #2c2f33; border: 1px solid var(--border); border-radius: 8px; padding: 6px; text-align: center; }
  .scroll-left, .scroll-right {
    background: none; border: none; color: #fff; font-size: 1.5em; padding: 6px 10px; cursor: pointer;
    position: absolute; top: 50%; transform: translateY(-50%); opacity: .6; text-shadow: 0 0 6px rgba(255,255,255,0.3);
  }
  .scroll-left { left: 6px; }
  .scroll-right { right: 6px; }

  .spinner {
    display: none; width: 44px; height: 44px;
    margin: 8px auto;
    border: 6px solid #333; border-top: 6px solid var(--accent);
    border-radius: 50%; animation: spin 1s linear infinite;
  }
  @keyframes spin { 100% { transform: rotate(360deg); } }

  .footer { text-align: center; opacity: .8; margin-top: 10px; font-size: .95em; }
</style>
</head>
<body>

<div class="topbar">
  <div class="version-tag">Verze 0.2</div>
  <div class="menu-container">
    <button class="menu-toggle" onclick="toggleMenu()">üìã Menu</button>
    <div class="menu-dropdown" id="mainMenu">
      <a href="https://www.lightpollutionmap.info" target="_blank">üí° Light Pollution Map</a>
      <a href="https://www.windy.com" target="_blank">üå¨Ô∏è Windy</a>
    </div>
  </div>
</div>

<h1>ü™ê Astronomick√° p≈ôedpovƒõƒè</h1>

<div class="controls">
  <div class="input-wrapper">
    <input id="cityInput" type="text" placeholder="Zadejte mƒõsto..." oninput="autocompleteCities()"/>
    <ul id="suggestions"></ul>
  </div>
  <button class="btn" onclick="getLocation()">üìç Moje poloha</button>
</div>

<div class="layout">
  <!-- Lev√Ω sloupec -->
  <div class="info-container">
    <div class="panel">
      <strong>üìç Informace o m√≠stƒõ</strong>
      <div class="kv" style="margin-top:8px;">
        <span><strong>N√°zev:</strong></span><span id="info-name">‚Äî</span>
        <span><strong>GPS:</strong></span><span id="info-gps">‚Äî</span>
        <span><strong>Mapa LP:</strong></span><span><a id="bortle-link" href="#" target="_blank" style="display:none; color:#00ffc3; text-decoration:underline; font-weight:bold;">Zobrazit Bortle</a></span>
      </div>
    </div>

    <div class="panel">
      <strong>üî≠ Astronomick√© informace</strong>
      <div id="moon-phase-display" style="margin-top: 8px;">
        <strong>üåô F√°ze Mƒõs√≠ce:</strong> <span id="moon-phase-label">‚Äî</span>
      </div>
      <div class="small" id="phase-raw" style="opacity:.8;margin-top:6px;"></div>
    </div>

    <div class="spinner" id="spinner"></div>
    <div id="forecast"></div>
  </div>

  <!-- Prav√Ω sloupec -->
  <div class="map-container">
    <div id="map" class="panel"></div>
    <iframe id="windyFrame" class="panel" src=""></iframe>

    <div class="panel">
      <strong>ü™ê Planety viditeln√© dnes ~22:00</strong>
      <div id="planet-log" class="small" style="margin:6px 0 8px 0; opacity:.85;"></div>
      <table style="width:100%; border-collapse: collapse;">
        <thead>
          <tr>
            <th style="border:1px solid var(--border); padding:6px;">Planeta</th>
            <th style="border:1px solid var(--border); padding:6px;">V√Ω≈°ka (¬∞)</th>
            <th style="border:1px solid var(--border); padding:6px;">Azimut (¬∞)</th>
          </tr>
        </thead>
        <tbody id="planet-table"></tbody>
      </table>
    </div>
  </div>
</div>

<div class="footer">
  Zdroj f√°z√≠ a planet: ipgeolocation.io ‚Ä¢ Poƒças√≠ a geok√≥dov√°n√≠: Open‚ÄëMeteo ‚Ä¢ Mapa: Leaflet & OSM
</div>

<script>
/* ===== Konfigurace ===== */
const IPGEO_API_KEY = "781aa2d69af74745906e01cc68c84207";

/* ===== Menu ===== */
function toggleMenu() {
  const menu = document.getElementById("mainMenu");
  menu.style.display = (menu.style.display === "block") ? "none" : "block";
}
document.addEventListener("click", (e) => {
  const menu = document.getElementById("mainMenu");
  const toggle = document.querySelector(".menu-toggle");
  if (menu && toggle && !menu.contains(e.target) && !toggle.contains(e.target)) {
    menu.style.display = "none";
  }
});

/* ===== Pomocn√© ===== */
const $ = (id) => document.getElementById(id);
function showSpinner(b) { $("spinner").style.display = b ? "block" : "none"; }
function getDayName(dateStr) {
  const today = new Date().toISOString().split('T')[0];
  if (dateStr === today) return "Dnes";
  const days = ['Nedƒõle', 'Pondƒõl√≠', '√öter√Ω', 'St≈ôeda', 'ƒåtvrtek', 'P√°tek', 'Sobota'];
  return days[new Date(dateStr).getDay()];
}
function getWeatherIcon(cloud, rain) {
  if (rain > 2) return 'üåßÔ∏è';
  if (rain > 0) return 'üå¶Ô∏è';
  if (cloud > 75) return '‚òÅÔ∏è';
  if (cloud > 25) return 'üå§Ô∏è';
  return '‚òÄÔ∏è';
}

/* ===== Geok√≥dov√°n√≠ a v√Ωbƒõr m√≠sta ===== */
let selectedCity = null;
async function autocompleteCities() {
  const input = $("cityInput").value.trim();
  const suggestions = $("suggestions");
  if (input.length < 2) { suggestions.style.display = "none"; return; }
  const res = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(input)}&count=6&language=cs&format=json`);
  const data = await res.json();
  suggestions.innerHTML = "";
  (data.results || []).forEach(city => {
    const li = document.createElement("li");
    li.textContent = `${city.name}, ${city.country}`;
    li.onclick = () => {
      selectedCity = city;
      $("cityInput").value = `${city.name}, ${city.country}`;
      updateLocationInfo(city);
      initMap(city.latitude, city.longitude);
      fetchForecast(city.latitude, city.longitude);
      fetchMoonPhase(city.latitude, city.longitude);
      fetchPlanets(city.latitude, city.longitude);
      updateWindyWidget(city.latitude, city.longitude);
      suggestions.style.display = "none";
    };
    suggestions.appendChild(li);
  });
  suggestions.style.display = suggestions.children.length ? "block" : "none";
}

async function getLocation() {
  if (!navigator.geolocation) return alert("V√°≈° prohl√≠≈æeƒç nepodporuje geolokaci.");
  navigator.geolocation.getCurrentPosition(async pos => {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    const name = await reverseGeocode(lat, lon);
    const city = { name, country: "", latitude: lat, longitude: lon };
    selectedCity = city;
    updateLocationInfo(city);
    initMap(lat, lon);
    fetchForecast(lat, lon);
    fetchMoonPhase(lat, lon);
    fetchPlanets(lat, lon);
    updateWindyWidget(lat, lon);
  }, err => alert("Nepoda≈ôilo se zjistit polohu."));
}

async function reverseGeocode(lat, lon) {
  try {
    const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=10&addressdetails=1`);
    const data = await res.json();
    return data.address?.city || data.address?.town || data.address?.village || data.address?.municipality || data.display_name || `${lat.toFixed(4)}, ${lon.toFixed(4)}`;
  } catch {
    return `${lat.toFixed(4)}, ${lon.toFixed(4)}`;
  }
}

function updateLocationInfo(city) {
  const name = city.name || "-";
  const country = city.country || "";
  const lat = typeof city.latitude === "number" ? city.latitude : null;
  const lon = typeof city.longitude === "number" ? city.longitude : null;
  $("info-name").innerHTML = country ? `<span style="color:#00ffc3; font-weight:bold;">${name}</span>, ${country}`
                                     : `<span style="color:#00ffc3; font-weight:bold;">${name}</span>`;
  $("info-gps").textContent = (lat!=null && lon!=null) ? `${lat.toFixed(4)}, ${lon.toFixed(4)}` : "‚Äî";
  const link = $("bortle-link");
  if (lat!=null && lon!=null) {
    link.href = `https://www.lightpollutionmap.info/#zoom=9&lat=${lat}&lon=${lon}`;
    link.style.display = "inline";
  } else {
    link.style.display = "none";
  }
}

/* ===== Mapa + Windy ===== */
let map = null, marker = null;
function initMap(lat, lon) {
  if (!map) {
    map = L.map('map', { scrollWheelZoom: false }).setView([lat, lon], 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '¬© OpenStreetMap' }).addTo(map);
    marker = L.marker([lat, lon]).addTo(map);
  } else {
    map.setView([lat, lon], 10);
    marker.setLatLng([lat, lon]);
  }
  // sync heights
  const mapDiv = $("map"), windy = $("windyFrame");
  if (mapDiv && windy) {
    const h = mapDiv.offsetWidth; // keep square
    mapDiv.style.height = h + "px";
    windy.style.height = h + "px";
    setTimeout(()=> map.invalidateSize(), 200);
  }
}
function updateWindyWidget(lat, lon) {
  const windy = $("windyFrame");
  windy.src = `https://embed.windy.com/embed2.html?lat=${lat}&lon=${lon}&zoom=11&level=surface&overlay=satellite&menu=&message=&marker=&calendar=now&type=satellite&location=coordinates&detail=&metricWind=default&metricTemp=default`;
}

/* ===== F√°ze Mƒõs√≠ce (API, ƒçesky) ===== */
function getMoonEmojiFromName(name) {
  const n = String(name||"").toLowerCase().replace(/_/g, " ").trim();
  if (n.includes("new moon")) return "üåë Nov";
  if (n.includes("waxing crescent")) return "üåí Dor≈Østaj√≠c√≠ srpek";
  if (n.includes("first quarter")) return "üåì Prvn√≠ ƒçtvr≈•";
  if (n.includes("waxing gibbous")) return "üåî Dor≈Østaj√≠c√≠ mƒõs√≠c";
  if (n.includes("full moon")) return "üåï √öplnƒõk";
  if (n.includes("waning gibbous")) return "üåñ Couvaj√≠c√≠ mƒõs√≠c";
  if (n.includes("last quarter")) return "üåó Posledn√≠ ƒçtvr≈•";
  if (n.includes("waning crescent")) return "üåò Couvaj√≠c√≠ srpek";
  return "üåô Nezn√°m√° f√°ze";
}
async function fetchMoonPhase(lat, lon) {
  const url = `https://api.ipgeolocation.io/astronomy?apiKey=${IPGEO_API_KEY}&lat=${lat}&long=${lon}`;
  try {
    const res = await fetch(url);
    const data = await res.json();
    const phase = data.moon_phase || "Nezn√°m√° f√°ze";
    $("moon-phase-label").textContent = getMoonEmojiFromName(phase);
    $("phase-raw").textContent = phase ? `API: ${phase}` : "";
  } catch (err) {
    console.error("Chyba p≈ôi naƒç√≠t√°n√≠ f√°ze mƒõs√≠ce:", err);
    $("moon-phase-label").textContent = "Chyba naƒç√≠t√°n√≠";
    $("phase-raw").textContent = "";
  }
}

/* ===== P≈ôedpovƒõƒè poƒças√≠ + mƒõs√≠ƒçn√≠ emoji v hlaviƒçk√°ch ===== */
let moonPhasesByDate = {};
function getMoonEmojiFromFraction(phase) {
  if (phase === 0 || phase === 1) return "üåë";
  if (phase > 0 && phase < 0.25) return "üåí";
  if (phase === 0.25) return "üåì";
  if (phase > 0.25 && phase < 0.5) return "üåî";
  if (phase === 0.5) return "üåï";
  if (phase > 0.5 && phase < 0.75) return "üåñ";
  if (phase === 0.75) return "üåó";
  return "üåò";
}

async function fetchMoonPhasesForecast(lat, lon) {
  try {
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=moon_phase&timezone=Europe%2FPrague`;
    const res = await fetch(url);
    const data = await res.json();
    const dates = data.daily.time;
    const phases = data.daily.moon_phase;
    moonPhasesByDate = {};
    for (let i = 0; i < dates.length; i++) {
      moonPhasesByDate[dates[i]] = getMoonEmojiFromFraction(phases[i]);
    }
  } catch (err) {
    console.error("Chyba p≈ôi naƒç√≠t√°n√≠ mƒõs√≠ƒçn√≠ch f√°z√≠:", err);
  }
}

function addMoonPhasesToHeaders() {
  const headers = document.querySelectorAll(".forecast-day h3");
  headers.forEach(h => {
    const m = h.dataset.date;
    if (m && moonPhasesByDate[m] && !h.textContent.includes(moonPhasesByDate[m])) {
      h.innerHTML = h.innerHTML + " " + moonPhasesByDate[m];
    }
  });
}

async function fetchForecast(lat, lon) {
  showSpinner(true);
  await fetchMoonPhasesForecast(lat, lon);
  const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,cloudcover,precipitation,windspeed_10m&timezone=Europe/Prague`);
  const data = await res.json();
  showSpinner(false);
  const { time, temperature_2m, cloudcover, precipitation, windspeed_10m } = data.hourly;
  const forecastDiv = $("forecast");
  forecastDiv.innerHTML = "";

  const days = {};
  for (let i = 0; i < time.length; i++) {
    const [date, hour] = time[i].split('T');
    const hourNum = parseInt(hour.split(':')[0]);
    if (!days[date]) days[date] = [];
    const entry = { time: hour, temp: temperature_2m[i], cloud: cloudcover[i], rain: precipitation[i], wind: windspeed_10m[i] };
    days[date].push(entry);
    // extend previous day with morning hours to make 36h
    if (hourNum < 12) {
      const prevDate = new Date(date);
      prevDate.setDate(prevDate.getDate() - 1);
      const prevDateStr = prevDate.toISOString().split('T')[0];
      if (!days[prevDateStr]) days[prevDateStr] = [];
      days[prevDateStr].push(entry);
    }
  }

  Object.entries(days).forEach(([date, entries], idx) => {
    if (!entries.some(e => parseInt(e.time.split(':')[0]) >= 12)) return;

    const section = document.createElement('div');
    section.className = 'forecast-day';

    const header = document.createElement('h3');
    const contentId = `day-${idx}`;
    header.dataset.date = date;
    header.innerHTML = `<span id="${contentId}-icon">‚¨ÜÔ∏è</span> ${getDayName(date)}, ${date}
      <button class="btn" style="padding:4px 8px; font-size:.85em" onclick="event.stopPropagation(); centerTime('${contentId}', '12:00')">Poledne</button>
      <button class="btn" style="padding:4px 8px; font-size:.85em" onclick="event.stopPropagation(); centerTime('${contentId}', '23:00')">P≈Ølnoc</button>`;
    header.onclick = () => toggleForecast(contentId);
    section.appendChild(header);

    const content = document.createElement('div');
    content.className = 'forecast-content';
    content.id = contentId;
    content.style.display = 'block';

    const wrapper = document.createElement('div');
    wrapper.className = 'forecast-scroll-wrapper';

    const leftBtn = document.createElement('button');
    leftBtn.className = 'scroll-left';
    leftBtn.textContent = '‚óÄ';

    const rightBtn = document.createElement('button');
    rightBtn.className = 'scroll-right';
    rightBtn.textContent = '‚ñ∂';

    const scrollContainer = document.createElement('div');
    scrollContainer.className = 'forecast-scroll';

    leftBtn.onclick = () => scrollContainer.scrollBy({ left: -250, behavior: 'smooth' });
    rightBtn.onclick = () => scrollContainer.scrollBy({ left: 250, behavior: 'smooth' });

    wrapper.appendChild(leftBtn);
    wrapper.appendChild(scrollContainer);
    wrapper.appendChild(rightBtn);

    const nowIso = new Date().toISOString().split('T')[0];
    entries
      .filter(e => (date !== nowIso) || (parseInt(e.time.split(':')[0]) >= new Date().getHours()))
      .forEach(e => {
        const card = document.createElement('div');
        card.className = 'forecast-card';
        const icon = getWeatherIcon(e.cloud, e.rain);
        let qualityColor = e.cloud <= 25 ? 'green' : (e.cloud <= 75 ? 'orange' : 'red');
        card.innerHTML = `
          <div><strong>${e.time}</strong></div>
          <div style="font-size:1.4em">${icon}</div>
          <div>${e.temp}¬∞C</div>
          <div>‚òÅÔ∏è ${e.cloud}%</div>
          <div>üåßÔ∏è ${e.rain} mm</div>
          <div>üí® ${e.wind} km/h</div>
          <div style="width: 100%; height: 8px; background-color: ${qualityColor}; border-radius: 4px; margin-top: 4px;"></div>
        `;
        scrollContainer.appendChild(card);
      });

    content.appendChild(wrapper);
    section.appendChild(content);
    forecastDiv.appendChild(section);
  });

  // add moon emoji to headers
  addMoonPhasesToHeaders();
}

function toggleForecast(id) {
  const content = document.getElementById(id);
  const icon = document.getElementById(id + '-icon');
  if (content.style.display === 'none') { content.style.display = 'block'; icon.textContent = '‚¨ÜÔ∏è'; }
  else { content.style.display = 'none'; icon.textContent = '‚¨áÔ∏è'; }
}

function centerTime(contentId, targetTime) {
  const scrollContainer = document.querySelector(`#${contentId} .forecast-scroll`);
  if (!scrollContainer) return;
  const cards = scrollContainer.querySelectorAll('.forecast-card');
  for (let i = 0; i < cards.length; i++) {
    const strong = cards[i].querySelector('strong');
    if (strong && strong.textContent.trim() === targetTime) {
      const containerWidth = scrollContainer.clientWidth;
      const cardOffset = cards[i].offsetLeft;
      const cardWidth = cards[i].offsetWidth;
      scrollContainer.scrollTo({
        left: cardOffset - (containerWidth / 2) + (cardWidth / 2),
        behavior: 'smooth'
      });
      break;
    }
  }
}

/* ===== Planety (ipgeolocation.io) ===== */
async function fetchPlanets(lat, lon) {
  const apiKey = IPGEO_API_KEY;
  const url = `https://api.ipgeolocation.io/astronomy?apiKey=${apiKey}&lat=${lat}&long=${lon}`;
  const log = (msg) => $("planet-log").textContent = msg;

  try {
    const res = await fetch(url);
    const data = await res.json();
    const tbody = $("planet-table");
    tbody.innerHTML = "";

    const planets = [
      { name: "Mercury", altitude: parseFloat(data.mercury_altitude), azimuth: parseFloat(data.mercury_azimuth) },
      { name: "Venus",   altitude: parseFloat(data.venus_altitude),   azimuth: parseFloat(data.venus_azimuth) },
      { name: "Mars",    altitude: parseFloat(data.mars_altitude),    azimuth: parseFloat(data.mars_azimuth) },
      { name: "Jupiter", altitude: parseFloat(data.jupiter_altitude), azimuth: parseFloat(data.jupiter_azimuth) },
      { name: "Saturn",  altitude: parseFloat(data.saturn_altitude),  azimuth: parseFloat(data.saturn_azimuth) }
    ];
    let any = false;
    for (const p of planets) {
      if (isFinite(p.altitude) && p.altitude > 5) {
        tbody.innerHTML += `<tr>
          <td style="border:1px solid var(--border); padding:6px;">${p.name}</td>
          <td style="border:1px solid var(--border); padding:6px;">${p.altitude.toFixed(1)}</td>
          <td style="border:1px solid var(--border); padding:6px;">${p.azimuth.toFixed(1)}</td>
        </tr>`;
        any = true;
      }
    }
    if (!any) {
      tbody.innerHTML = `<tr><td colspan="3" style="border:1px solid var(--border); padding:6px; text-align:center;">≈Ω√°dn√© planety nejsou dob≈ôe viditeln√©.</td></tr>`;
    }
    log("‚úÖ Hotovo.");
  } catch (e) {
    $("planet-table").innerHTML = `<tr><td colspan="3" style="padding:6px;">Chyba naƒç√≠t√°n√≠ planet.</td></tr>`;
    log("‚ùå Chyba: " + e.message);
  }
}

/* ===== Start: voliteln√© ‚Äì naƒçten√≠ polohy hned po otev≈ôen√≠ ===== */
// Pokud chce≈° p≈ôi naƒçten√≠ hned po≈æ√°dat o polohu, odkomentuj:
// getLocation();

</script>
</body>
</html>
